<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投票值驗證測試</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
        }
        .test-result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px; 
        }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        button { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        #console { 
            background-color: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 15px; 
            margin-top: 20px; 
            height: 300px; 
            overflow-y: scroll; 
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>🎯 投票值驗證測試</h1>
    <p>此頁面用於測試修復後的投票值驗證邏輯</p>
    
    <button onclick="runAllTests()">執行所有測試</button>
    <button onclick="clearConsole()">清除控制台</button>
    
    <div id="results"></div>
    
    <h2>控制台輸出</h2>
    <div id="console"></div>

    <script>
        // 重寫 console.log 和 console.error 來顯示在頁面上
        const originalLog = console.log;
        const originalError = console.error;
        const consoleDiv = document.getElementById('console');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleDiv.innerHTML += '<div style="color: #28a745;">[LOG] ' + args.join(' ') + '</div>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            consoleDiv.innerHTML += '<div style="color: #dc3545;">[ERROR] ' + args.join(' ') + '</div>';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
        }
        
        // 內嵌 validateVoteValue 函數用於測試
        function validateVoteValue(vote) {
            // 允許的 Fibonacci 數列
            const allowedNumbers = [0, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 100];
            // 允許的特殊值 (包含多種表示方式)
            const allowedSpecial = ['?', '❓', 'question', '☕', 'coffee', '∞', 'infinity'];
            
            // 數字類型驗證
            if (typeof vote === 'number' && allowedNumbers.includes(vote)) {
                console.log(`✅ 有效數字投票值: ${vote}`);
                return vote;
            }
            
            // 字串類型驗證 (支援多種表示方式)
            if (typeof vote === 'string' && allowedSpecial.includes(vote)) {
                console.log(`✅ 有效特殊投票值: ${vote}`);
                return vote;
            }
            
            // 詳細錯誤日誌
            console.error(`❌ 無效的投票值:`, {
                value: vote,
                type: typeof vote,
                allowedNumbers,
                allowedSpecial
            });
            
            throw new Error(`無效的投票值: ${vote} (類型: ${typeof vote})`);
        }
        
        function showResult(testName, passed, message) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result ' + (passed ? 'pass' : 'fail');
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${passed ? '✅ 通過' : '❌ 失敗'} - ${message}`;
            resultsDiv.appendChild(resultDiv);
        }
        
        function testValidateVoteValue() {
            console.log('🧪 開始測試 validateVoteValue 函數...');
            
            const testCases = [
                // 有效數字
                { input: 0, expected: true, description: '數字 0' },
                { input: 1, expected: true, description: '數字 1' },
                { input: 2, expected: true, description: '數字 2' },
                { input: 3, expected: true, description: '數字 3' },
                { input: 5, expected: true, description: '數字 5' },
                { input: 8, expected: true, description: '數字 8' },
                { input: 13, expected: true, description: '數字 13' },
                { input: 21, expected: true, description: '數字 21' },
                { input: 34, expected: true, description: '數字 34' },
                { input: 55, expected: true, description: '數字 55' },
                { input: 89, expected: true, description: '數字 89' },
                { input: 100, expected: true, description: '數字 100' },
                
                // 有效特殊值
                { input: '?', expected: true, description: '問號字串' },
                { input: '❓', expected: true, description: '問號 emoji' },
                { input: 'question', expected: true, description: 'question 字串' },
                { input: '☕', expected: true, description: '咖啡 emoji' },
                { input: 'coffee', expected: true, description: 'coffee 字串' },
                { input: '∞', expected: true, description: '無限符號' },
                { input: 'infinity', expected: true, description: 'infinity 字串' },
                
                // 無效值
                { input: 4, expected: false, description: '無效數字 4' },
                { input: 6, expected: false, description: '無效數字 6' },
                { input: 7, expected: false, description: '無效數字 7' },
                { input: 'invalid', expected: false, description: '無效字串' },
                { input: null, expected: false, description: 'null 值' },
                { input: undefined, expected: false, description: 'undefined 值' },
                { input: [], expected: false, description: '陣列' },
                { input: {}, expected: false, description: '物件' }
            ];
            
            testCases.forEach(testCase => {
                try {
                    const result = validateVoteValue(testCase.input);
                    if (testCase.expected) {
                        showResult(`測試 ${testCase.description}`, true, `返回值: ${result}`);
                    } else {
                        showResult(`測試 ${testCase.description}`, false, '應該拋出錯誤但沒有');
                    }
                } catch (error) {
                    if (testCase.expected) {
                        showResult(`測試 ${testCase.description}`, false, `意外錯誤: ${error.message}`);
                    } else {
                        showResult(`測試 ${testCase.description}`, true, `正確拋出錯誤: ${error.message}`);
                    }
                }
            });
            
            console.log('✅ validateVoteValue 測試完成');
        }
        
        function runAllTests() {
            document.getElementById('results').innerHTML = '';
            clearConsole();
            console.log('🚀 開始執行投票值驗證測試...');
            testValidateVoteValue();
            console.log('🎉 所有測試執行完畢！');
        }
    </script>
</body>
</html>