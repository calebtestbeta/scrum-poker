<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ·éµæç¤ºç³»çµ±æ¸¬è©¦</title>
    <style>
        body {
            margin: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .test-panel {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        button {
            padding: 10px 15px;
            margin: 5px;
            border: 1px solid #007acc;
            background: #007acc;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #005999;
        }
        
        .status {
            font-weight: bold;
            margin: 10px 0;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª å¿«æ·éµæç¤ºç³»çµ±æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h2>1. æ¨¡çµ„è¼‰å…¥æ¸¬è©¦</h2>
            <div id="moduleStatus" class="status">è¼‰å…¥ä¸­...</div>
            <button onclick="testModuleLoading()">é‡æ–°æª¢æŸ¥æ¨¡çµ„</button>
        </div>
        
        <div class="test-section">
            <h2>2. å¿«æ·éµæç¤ºæ¸²æŸ“æ¸¬è©¦</h2>
            <div class="test-panel">
                <div class="shortcut-hints" id="testShortcutHints">
                    <h4>âŒ¨ï¸ å¿«æ·éµ</h4>
                    <div class="shortcuts-list">
                        <!-- å¿«æ·éµå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
                    </div>
                </div>
            </div>
            <div id="renderStatus" class="status">ç­‰å¾…æ¸¬è©¦...</div>
            <button onclick="testShortcutRendering()">æ¸¬è©¦æ¸²æŸ“</button>
            <button onclick="testEmptyShortcuts()">æ¸¬è©¦ç©ºé™£åˆ—</button>
            <button onclick="testInvalidInput()">æ¸¬è©¦ç„¡æ•ˆè¼¸å…¥</button>
        </div>
        
        <div class="test-section">
            <h2>3. é¢æ¿åˆ‡æ›æ¸¬è©¦</h2>
            <div class="test-panel" id="testPanel">
                <p>é€™æ˜¯æ¸¬è©¦é¢æ¿ - åˆå§‹ç‹€æ…‹: é¡¯ç¤º</p>
            </div>
            <div id="panelStatus" class="status">é¢æ¿ç‹€æ…‹: é¡¯ç¤º</div>
            <button onclick="testPanelToggle()">åˆ‡æ›é¢æ¿</button>
        </div>
        
        <div class="test-section">
            <h2>4. äº‹ä»¶åŒ¯æµæ’æ¸¬è©¦</h2>
            <div id="eventStatus" class="status">ç­‰å¾…äº‹ä»¶...</div>
            <button onclick="testEventBus()">æ¸¬è©¦äº‹ä»¶ç™¼å¸ƒ</button>
            <button onclick="clearEventLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        
        <div class="test-section">
            <h2>5. éµç›¤å¿«æ·éµæ¸¬è©¦</h2>
            <div class="info">
                <p>è«‹å˜—è©¦ä»¥ä¸‹å¿«æ·éµï¼š</p>
                <ul>
                    <li><kbd>H</kbd> - åˆ‡æ›é¢æ¿</li>
                    <li><kbd>Space</kbd> - æ¸¬è©¦ç©ºç™½éµ</li>
                    <li><kbd>1-9</kbd> - æ¸¬è©¦æ•¸å­—éµ</li>
                </ul>
            </div>
            <div id="keyboardStatus" class="status">æŒ‰éµç›£è½ä¸­...</div>
        </div>
    </div>

    <!-- è¼‰å…¥æ¨£å¼ -->
    <link rel="stylesheet" href="src/styles/variables.css">
    <link rel="stylesheet" href="src/styles/main.css">
    
    <!-- è¼‰å…¥æ¨¡çµ„ -->
    <script type="module">
        import { shortcutHintsManager, getDefaultShortcuts, formatShortcutsHTML } from './src/ui/ShortcutHints.js';
        import { panelManager } from './src/ui/PanelManager.js';
        
        // æš´éœ²åˆ°å…¨åŸŸä»¥ä¾¿æ¸¬è©¦
        window.shortcutHintsManager = shortcutHintsManager;
        window.panelManager = panelManager;
        window.getDefaultShortcuts = getDefaultShortcuts;
        window.formatShortcutsHTML = formatShortcutsHTML;
        
        // æ¨¡æ“¬ EventBus
        window.eventBus = {
            listeners: new Map(),
            emit(event, data) {
                console.log('ğŸ”„ äº‹ä»¶ç™¼å¸ƒ:', event, data);
                const log = document.getElementById('eventStatus');
                log.innerHTML += `<div>ğŸ“¤ ${event}: ${JSON.stringify(data)}</div>`;
                
                if (this.listeners.has(event)) {
                    this.listeners.get(event).forEach(callback => callback(data));
                }
            },
            on(event, callback) {
                if (!this.listeners.has(event)) {
                    this.listeners.set(event, []);
                }
                this.listeners.get(event).push(callback);
            }
        };
        
        console.log('âœ… æ¸¬è©¦ç’°å¢ƒè¼‰å…¥å®Œæˆ');
        testModuleLoading();
        
        // éµç›¤äº‹ä»¶ç›£è½
        document.addEventListener('keydown', (event) => {
            const keyStatus = document.getElementById('keyboardStatus');
            keyStatus.innerHTML = `æŒ‰ä¸‹: <kbd>${event.key}</kbd> (${event.code})`;
            
            if (event.key === 'h' || event.key === 'H') {
                event.preventDefault();
                testPanelToggle();
            }
        });
    </script>
    
    <script>
        // æ¸¬è©¦å‡½æ•¸
        function testModuleLoading() {
            const status = document.getElementById('moduleStatus');
            
            if (window.shortcutHintsManager && window.panelManager) {
                status.innerHTML = '<span class="success">âœ… æ¨¡çµ„è¼‰å…¥æˆåŠŸ</span>';
            } else {
                status.innerHTML = '<span class="error">âŒ æ¨¡çµ„è¼‰å…¥å¤±æ•—</span>';
            }
        }
        
        function testShortcutRendering() {
            const status = document.getElementById('renderStatus');
            
            try {
                const result = window.shortcutHintsManager.updateShortcutHints({
                    containerId: 'testShortcutHints'
                });
                
                if (result) {
                    status.innerHTML = '<span class="success">âœ… å¿«æ·éµæ¸²æŸ“æˆåŠŸ</span>';
                } else {
                    status.innerHTML = '<span class="error">âŒ å¿«æ·éµæ¸²æŸ“å¤±æ•—</span>';
                }
            } catch (error) {
                status.innerHTML = `<span class="error">âŒ æ¸²æŸ“éŒ¯èª¤: ${error.message}</span>`;
            }
        }
        
        function testEmptyShortcuts() {
            const status = document.getElementById('renderStatus');
            
            try {
                const result = window.shortcutHintsManager.updateShortcutHints({
                    containerId: 'testShortcutHints',
                    shortcuts: []
                });
                
                status.innerHTML = '<span class="info">â„¹ï¸ ç©ºé™£åˆ—æ¸¬è©¦å®Œæˆ</span>';
            } catch (error) {
                status.innerHTML = `<span class="error">âŒ ç©ºé™£åˆ—æ¸¬è©¦å¤±æ•—: ${error.message}</span>`;
            }
        }
        
        function testInvalidInput() {
            const status = document.getElementById('renderStatus');
            
            try {
                const result = window.shortcutHintsManager.updateShortcutHints({
                    containerId: 'nonexistent'
                });
                
                status.innerHTML = '<span class="info">â„¹ï¸ ç„¡æ•ˆè¼¸å…¥æ¸¬è©¦å®Œæˆï¼ˆæ‡‰è©²å®‰å…¨é™ç´šï¼‰</span>';
            } catch (error) {
                status.innerHTML = `<span class="error">âŒ ç„¡æ•ˆè¼¸å…¥æ¸¬è©¦å¤±æ•—: ${error.message}</span>`;
            }
        }
        
        function testPanelToggle() {
            const panel = document.getElementById('testPanel');
            const status = document.getElementById('panelStatus');
            
            try {
                const isOpen = window.panelManager.togglePanel('testPanel', 'manual');
                status.innerHTML = `é¢æ¿ç‹€æ…‹: ${isOpen ? 'é¡¯ç¤º' : 'éš±è—'}`;
            } catch (error) {
                status.innerHTML = `<span class="error">âŒ é¢æ¿åˆ‡æ›å¤±æ•—: ${error.message}</span>`;
            }
        }
        
        function testEventBus() {
            if (window.eventBus) {
                window.eventBus.emit('UI/ShortcutHintsRendered', {
                    count: 6,
                    items: window.getDefaultShortcuts()
                });
                
                window.eventBus.emit('UI/PanelToggled', {
                    panelId: 'testPanel',
                    isOpen: true,
                    reason: 'manual'
                });
            }
        }
        
        function clearEventLog() {
            document.getElementById('eventStatus').innerHTML = 'äº‹ä»¶æ—¥èªŒå·²æ¸…é™¤';
        }
    </script>
</body>
</html>