{
  "rules": {
    "rooms": {
      "$roomId": {
        ".read": "auth != null",
        ".write": "auth != null",
        
        "players": {
          ".read": "auth != null",
          ".write": "auth != null"
        },
        
        "votes": {
          ".read": "auth != null",
          ".write": "auth != null"
        },
        
        "learning_data": {
          ".read": "auth != null",
          ".write": "auth != null",
          
          "current_advice": {
            ".read": "auth != null",
            ".write": "auth != null",
            
            "visible_to_all": {
              ".validate": "newData.val() === true"
            }
          },
          
          "session_history": {
            ".read": "auth != null",
            ".write": "auth != null",
            
            "$sessionId": {
              "anonymous_votes": {
                "$anonId": {
                  ".validate": "newData.hasChild('role') && newData.hasChild('value') && newData.child('role').isString() && (newData.child('value').isNumber() || newData.child('value').isString())"
                }
              },
              
              "statistics": {
                ".validate": "newData.hasChild('average_points') && newData.hasChild('consensus') && newData.hasChild('total_votes')"
              }
            }
          },
          
          "learning_model": {
            ".read": "auth != null",
            ".write": "auth != null"
          },
          
          "metadata": {
            ".read": "auth != null",
            ".write": "auth != null",
            
            "cleanup_threshold": {
              ".validate": "newData.isNumber() && newData.val() > 0"
            }
          }
        },
        
        "phase": {
          ".validate": "newData.isString() && (newData.val() === 'voting' || newData.val() === 'revealing' || newData.val() === 'finished')"
        },
        
        "task_type": {
          ".validate": "newData.isString()"
        }
      }
    },
    
    "$other": {
      ".validate": false
    }
  }
}