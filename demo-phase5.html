<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScrumAdviceEngine Phase 5 å­¸ç¿’æ©Ÿåˆ¶æ¼”ç¤º</title>
    <link rel="stylesheet" href="src/styles/variables.css">
    <link rel="stylesheet" href="src/styles/main.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-game);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .demo-header h1 {
            color: var(--text-inverse);
            margin-bottom: 10px;
        }
        
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .demo-section h2 {
            color: var(--text-inverse);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .demo-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .demo-card h3 {
            color: var(--text-inverse);
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        
        .demo-card p {
            color: rgba(255, 255, 255, 0.8);
            margin: 0 0 15px 0;
            font-size: 14px;
        }
        
        .demo-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn-demo {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: var(--color-primary);
            color: var(--text-inverse);
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        
        .btn-demo:hover {
            background: var(--color-primary-dark);
        }
        
        .btn-demo.secondary {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-demo.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .info-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            border-left: 3px solid var(--color-primary);
        }
        
        .info-display h4 {
            color: var(--text-inverse);
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        
        .info-display pre {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            line-height: 1.4;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .learning-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--color-primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>ğŸ§  ScrumAdviceEngine Phase 5</h1>
            <p style="color: rgba(255, 255, 255, 0.8);">å­¸ç¿’æ©Ÿåˆ¶èˆ‡å€‹äººåŒ–å»ºè­°æ¼”ç¤º</p>
        </div>
        
        <!-- å­¸ç¿’æ¨¡å‹ç‹€æ…‹ -->
        <div class="demo-section">
            <h2>ğŸ“š å­¸ç¿’æ¨¡å‹ç‹€æ…‹</h2>
            <div class="learning-stats" id="learningStats">
                <div class="stat-item">
                    <div class="stat-value" id="totalSessions">-</div>
                    <div class="stat-label">æŠ•ç¥¨æœƒè©±</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="taskTypesCount">-</div>
                    <div class="stat-label">ä»»å‹™é¡å‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="rolesCount">-</div>
                    <div class="stat-label">è§’è‰²é¡å‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="modelVersion">-</div>
                    <div class="stat-label">æ¨¡å‹ç‰ˆæœ¬</div>
                </div>
            </div>
            
            <div class="demo-controls">
                <button class="btn-demo" id="refreshStats">ğŸ”„ åˆ·æ–°ç‹€æ…‹</button>
                <button class="btn-demo secondary" id="clearLearningData">ğŸ—‘ï¸ æ¸…é™¤å­¸ç¿’è³‡æ–™</button>
            </div>
            
            <div class="info-display" id="learningModelInfo">
                <h4>ğŸ“Š å­¸ç¿’æ¨¡å‹è©³ç´°è³‡è¨Š</h4>
                <pre>é»æ“Šã€Œåˆ·æ–°ç‹€æ…‹ã€è¼‰å…¥å­¸ç¿’æ¨¡å‹è³‡è¨Š</pre>
            </div>
        </div>
        
        <!-- æ¨¡æ“¬è¨“ç·´è³‡æ–™ -->
        <div class="demo-section">
            <h2>ğŸ² æ¨¡æ“¬è¨“ç·´è³‡æ–™ç”Ÿæˆ</h2>
            <div class="demo-grid">
                <div class="demo-card">
                    <h3>ğŸ—ï¸ å¾Œç«¯é–‹ç™¼å ´æ™¯</h3>
                    <p>æ¨¡æ“¬å¾Œç«¯åœ˜éšŠçš„æŠ•ç¥¨æ¨¡å¼ï¼ŒåŒ…å« API è¨­è¨ˆã€è³‡æ–™åº«å„ªåŒ–ç­‰è¤‡é›œä»»å‹™</p>
                    <button class="btn-demo" onclick="generateTrainingData('backend', 5)">ç”Ÿæˆ 5 ç­†è³‡æ–™</button>
                </div>
                
                <div class="demo-card">
                    <h3>ğŸ¨ å‰ç«¯é–‹ç™¼å ´æ™¯</h3>
                    <p>æ¨¡æ“¬å‰ç«¯åœ˜éšŠçš„æŠ•ç¥¨æ¨¡å¼ï¼ŒåŒ…å« UI/UX å¯¦ä½œã€éŸ¿æ‡‰å¼è¨­è¨ˆç­‰</p>
                    <button class="btn-demo" onclick="generateTrainingData('frontend', 5)">ç”Ÿæˆ 5 ç­†è³‡æ–™</button>
                </div>
                
                <div class="demo-card">
                    <h3>ğŸ§ª æ¸¬è©¦å ´æ™¯</h3>
                    <p>æ¨¡æ“¬ QA åœ˜éšŠçš„æŠ•ç¥¨æ¨¡å¼ï¼ŒåŒ…å«è‡ªå‹•åŒ–æ¸¬è©¦ã€æ¸¬è©¦ç”¨ä¾‹è¨­è¨ˆç­‰</p>
                    <button class="btn-demo" onclick="generateTrainingData('testing', 3)">ç”Ÿæˆ 3 ç­†è³‡æ–™</button>
                </div>
                
                <div class="demo-card">
                    <h3>ğŸš€ DevOps å ´æ™¯</h3>
                    <p>æ¨¡æ“¬ DevOps åœ˜éšŠçš„æŠ•ç¥¨æ¨¡å¼ï¼ŒåŒ…å« CI/CDã€ç›£æ§ç³»çµ±ç­‰</p>
                    <button class="btn-demo" onclick="generateTrainingData('devops', 3)">ç”Ÿæˆ 3 ç­†è³‡æ–™</button>
                </div>
            </div>
        </div>
        
        <!-- å€‹äººåŒ–å»ºè­°æ¸¬è©¦ -->
        <div class="demo-section">
            <h2>ğŸ¯ å€‹äººåŒ–å»ºè­°æ¸¬è©¦</h2>
            <div class="demo-controls">
                <button class="btn-demo" id="testPersonalizedAdvice">ğŸ§  æ¸¬è©¦å€‹äººåŒ–å»ºè­°</button>
                <button class="btn-demo secondary" id="testHistoryComparison">ğŸ“ˆ æ¸¬è©¦æ­·å²å°æ¯”</button>
            </div>
            
            <div class="info-display" id="personalizedAdviceResult">
                <h4>ğŸ¤– å€‹äººåŒ–å»ºè­°çµæœ</h4>
                <pre>é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ¸¬è©¦å€‹äººåŒ–å»ºè­°åŠŸèƒ½</pre>
            </div>
        </div>
        
        <!-- å­¸ç¿’æ´å¯Ÿ -->
        <div class="demo-section">
            <h2>ğŸ’¡ å­¸ç¿’æ´å¯Ÿå±•ç¤º</h2>
            <div class="info-display" id="learningInsights">
                <h4>ğŸ“š åœ˜éšŠå­¸ç¿’æ´å¯Ÿ</h4>
                <pre>è¼‰å…¥ä¸­...</pre>
            </div>
        </div>
    </div>
    
    <!-- è¼‰å…¥è…³æœ¬ -->
    <script src="src/services/ScrumAdviceEngine.js"></script>
    <script src="src/services/ScrumAdviceUI.js"></script>
    
    <script>
        // Phase 5 å­¸ç¿’æ©Ÿåˆ¶æ¼”ç¤ºè…³æœ¬
        let adviceEngine = null;
        let adviceUI = null;
        
        // åˆå§‹åŒ–æ¼”ç¤º
        async function initializeDemo() {
            console.log('ğŸ¬ åˆå§‹åŒ– Phase 5 å­¸ç¿’æ©Ÿåˆ¶æ¼”ç¤º...');
            
            try {
                // åˆå§‹åŒ–å»ºè­°å¼•æ“
                adviceEngine = new ScrumAdviceEngine();
                
                // åˆå§‹åŒ– UI ç®¡ç†å™¨
                adviceUI = new ScrumAdviceUI();
                await adviceUI.initialize();
                
                console.log('âœ… Phase 5 æ¼”ç¤ºåˆå§‹åŒ–æˆåŠŸ');
                
                // è¼‰å…¥åˆå§‹ç‹€æ…‹
                refreshLearningStats();
                showLearningInsights();
                
                // è¨­å®šäº‹ä»¶ç›£è½
                setupEventListeners();
                
            } catch (error) {
                console.error('âŒ æ¼”ç¤ºåˆå§‹åŒ–å¤±æ•—:', error);
            }
        }
        
        // è¨­å®šäº‹ä»¶ç›£è½
        function setupEventListeners() {
            document.getElementById('refreshStats').addEventListener('click', refreshLearningStats);
            document.getElementById('clearLearningData').addEventListener('click', clearLearningData);
            document.getElementById('testPersonalizedAdvice').addEventListener('click', testPersonalizedAdvice);
            document.getElementById('testHistoryComparison').addEventListener('click', testHistoryComparison);
        }
        
        // åˆ·æ–°å­¸ç¿’çµ±è¨ˆ
        function refreshLearningStats() {
            if (!adviceEngine) return;
            
            const summary = adviceEngine.getVotingHistorySummary();
            
            if (summary.available) {
                document.getElementById('totalSessions').textContent = summary.totalSessions;
                document.getElementById('taskTypesCount').textContent = summary.taskTypes.length;
                document.getElementById('rolesCount').textContent = summary.roles.length;
                document.getElementById('modelVersion').textContent = summary.modelVersion;
                
                document.getElementById('learningModelInfo').innerHTML = `
                    <h4>ğŸ“Š å­¸ç¿’æ¨¡å‹è©³ç´°è³‡è¨Š</h4>
                    <pre>ç¸½æŠ•ç¥¨æœƒè©±: ${summary.totalSessions} æ¬¡
æ—¥æœŸç¯„åœ: ${summary.dateRange.oldest} ~ ${summary.dateRange.newest}
ä»»å‹™é¡å‹: ${summary.taskTypes.join(', ') || 'ç„¡'}
è§’è‰²é¡å‹: ${summary.roles.join(', ') || 'ç„¡'}
æœ€å¾Œæ›´æ–°: ${summary.lastUpdated}</pre>
                `;
            } else {
                document.getElementById('totalSessions').textContent = '0';
                document.getElementById('taskTypesCount').textContent = '0';
                document.getElementById('rolesCount').textContent = '0';
                document.getElementById('modelVersion').textContent = 'N/A';
                
                document.getElementById('learningModelInfo').innerHTML = `
                    <h4>ğŸ“Š å­¸ç¿’æ¨¡å‹è©³ç´°è³‡è¨Š</h4>
                    <pre>å°šç„¡å­¸ç¿’è³‡æ–™ï¼Œè«‹å…ˆç”Ÿæˆä¸€äº›è¨“ç·´è³‡æ–™</pre>
                `;
            }
        }
        
        // ç”Ÿæˆè¨“ç·´è³‡æ–™
        function generateTrainingData(taskType, count) {
            if (!adviceEngine) return;
            
            console.log(`ğŸ² ç”Ÿæˆ ${taskType} é¡å‹çš„ ${count} ç­†è¨“ç·´è³‡æ–™...`);
            
            for (let i = 0; i < count; i++) {
                const mockData = generateMockSessionData(taskType);
                adviceEngine.recordVotingSession(mockData);
            }
            
            console.log(`âœ… å·²ç”Ÿæˆ ${count} ç­† ${taskType} è¨“ç·´è³‡æ–™`);
            refreshLearningStats();
            showLearningInsights();
        }
        
        // ç”Ÿæˆæ¨¡æ“¬æœƒè©±è³‡æ–™
        function generateMockSessionData(taskType) {
            const roles = ['dev', 'qa', 'scrum_master', 'po', 'other'];
            const players = {};
            const votes = {};
            
            // æ ¹æ“šä»»å‹™é¡å‹èª¿æ•´æŠ•ç¥¨ç¯„åœ
            const pointRanges = {
                'frontend': [1, 2, 3, 5, 8],
                'backend': [3, 5, 8, 13, 21],
                'testing': [2, 3, 5, 8, 13],
                'devops': [5, 8, 13, 21, 34],
                'general': [1, 2, 3, 5, 8, 13, 21]
            };
            
            const points = pointRanges[taskType] || pointRanges['general'];
            const playerCount = Math.floor(Math.random() * 4) + 3; // 3-6 ç©å®¶
            
            // ç”Ÿæˆç©å®¶å’ŒæŠ•ç¥¨
            for (let i = 0; i < playerCount; i++) {
                const playerId = `player_${i + 1}`;
                const role = roles[Math.floor(Math.random() * roles.length)];
                
                players[playerId] = {
                    name: `Player ${i + 1}`,
                    role: role
                };
                
                // æ ¹æ“šè§’è‰²å½±éŸ¿æŠ•ç¥¨å‚¾å‘
                let voteValue;
                if (role === 'dev') {
                    voteValue = points[Math.floor(Math.random() * Math.min(3, points.length))]; // å‚¾å‘è¼ƒä½ä¼°é»
                } else if (role === 'qa') {
                    voteValue = points[Math.floor(Math.random() * points.length)]; // å¹³å‡åˆ†å¸ƒ
                } else if (role === 'scrum_master' || role === 'po') {
                    voteValue = points[Math.floor(points.length / 2) + Math.floor(Math.random() * Math.max(1, points.length - Math.floor(points.length / 2)))]; // å‚¾å‘è¼ƒé«˜ä¼°é»
                } else {
                    voteValue = points[Math.floor(Math.random() * points.length)];
                }
                
                votes[playerId] = {
                    value: voteValue,
                    timestamp: Date.now() - Math.floor(Math.random() * 1000000),
                    player_role: role
                };
            }
            
            return {
                taskType: taskType,
                players: players,
                votes: votes,
                sessionInfo: {
                    roomId: `demo_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                    timestamp: Date.now()
                }
            };
        }
        
        // æ¸¬è©¦å€‹äººåŒ–å»ºè­°
        async function testPersonalizedAdvice() {
            if (!adviceUI) return;
            
            console.log('ğŸ§  æ¸¬è©¦å€‹äººåŒ–å»ºè­°...');
            
            // ç”Ÿæˆæ¸¬è©¦ç”¨çš„æŠ•ç¥¨è³‡æ–™
            const testData = generateMockSessionData('frontend');
            
            try {
                await adviceUI.generateAdviceFromVotes({ votes: testData.votes }, {
                    taskType: testData.taskType,
                    players: testData.players
                });
                
                if (adviceUI.currentAdvice) {
                    document.getElementById('personalizedAdviceResult').innerHTML = `
                        <h4>ğŸ¤– å€‹äººåŒ–å»ºè­°çµæœ</h4>
                        <pre>${JSON.stringify({
                            type: adviceUI.currentAdvice.metadata.type,
                            analysisDepth: adviceUI.currentAdvice.metadata.analysisDepth,
                            hasLearningInsights: !!adviceUI.currentAdvice.learningInsights,
                            modelInfo: adviceUI.currentAdvice.metadata.modelInfo,
                            contentLength: adviceUI.currentAdvice.content.length
                        }, null, 2)}</pre>
                    `;
                    
                    // é¡¯ç¤ºå®Œæ•´å»ºè­°
                    adviceUI.showFullAdvice();
                }
                
            } catch (error) {
                console.error('âŒ æ¸¬è©¦å€‹äººåŒ–å»ºè­°å¤±æ•—:', error);
                document.getElementById('personalizedAdviceResult').innerHTML = `
                    <h4>âŒ æ¸¬è©¦å¤±æ•—</h4>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        // æ¸¬è©¦æ­·å²å°æ¯”
        function testHistoryComparison() {
            if (!adviceEngine) return;
            
            const testData = generateMockSessionData('backend');
            const enhancement = adviceEngine.applyLearningModel(testData);
            
            document.getElementById('personalizedAdviceResult').innerHTML = `
                <h4>ğŸ“ˆ æ­·å²å°æ¯”æ¸¬è©¦çµæœ</h4>
                <pre>${JSON.stringify(enhancement, null, 2)}</pre>
            `;
        }
        
        // æ¸…é™¤å­¸ç¿’è³‡æ–™
        function clearLearningData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å­¸ç¿’è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                try {
                    localStorage.removeItem('scrumPoker_votingHistory');
                    localStorage.removeItem('scrumPoker_learningModel');
                    console.log('ğŸ—‘ï¸ å­¸ç¿’è³‡æ–™å·²æ¸…é™¤');
                    refreshLearningStats();
                    showLearningInsights();
                } catch (error) {
                    console.error('âŒ æ¸…é™¤å¤±æ•—:', error);
                }
            }
        }
        
        // é¡¯ç¤ºå­¸ç¿’æ´å¯Ÿ
        function showLearningInsights() {
            if (!adviceEngine) return;
            
            try {
                const summary = adviceEngine.getVotingHistorySummary();
                
                if (summary.available) {
                    document.getElementById('learningInsights').innerHTML = `
                        <h4>ğŸ“š åœ˜éšŠå­¸ç¿’æ´å¯Ÿ</h4>
                        <pre>âœ¨ åŸºæ–¼ ${summary.totalSessions} æ¬¡æŠ•ç¥¨æœƒè©±çš„æ´å¯Ÿï¼š

ğŸ¯ ä»»å‹™é¡å‹åˆ†æï¼š
${summary.taskTypes.map(type => `   â€¢ ${type}: å·²ç´¯ç©æŠ•ç¥¨æ¨¡å¼`).join('\\n') || '   å°šç„¡ä»»å‹™é¡å‹è³‡æ–™'}

ğŸ‘¥ è§’è‰²æŠ•ç¥¨æ¨¡å¼ï¼š
${summary.roles.map(role => `   â€¢ ${role}: å·²å­¸ç¿’æŠ•ç¥¨å‚¾å‘`).join('\\n') || '   å°šç„¡è§’è‰²æŠ•ç¥¨è³‡æ–™'}

ğŸ§  å€‹äººåŒ–ç¨‹åº¦ï¼š${summary.totalSessions > 10 ? 'é«˜' : summary.totalSessions > 5 ? 'ä¸­' : 'ä½'}
ğŸ“Š è³‡æ–™è±å¯Œåº¦ï¼š${summary.taskTypes.length > 3 ? 'è±å¯Œ' : 'ä¸€èˆ¬'}</pre>
                    `;
                } else {
                    document.getElementById('learningInsights').innerHTML = `
                        <h4>ğŸ“š åœ˜éšŠå­¸ç¿’æ´å¯Ÿ</h4>
                        <pre>ğŸš€ æ­¡è¿ä½¿ç”¨æ™ºæ…§å»ºè­°ç³»çµ±ï¼

ç›®å‰å°šæœªç´¯ç©è¶³å¤ çš„å­¸ç¿’è³‡æ–™ã€‚
è«‹å…ˆç”Ÿæˆä¸€äº›è¨“ç·´è³‡æ–™ä»¥é«”é©—å€‹äººåŒ–å»ºè­°åŠŸèƒ½ï¼š

1. é»æ“Šä¸Šæ–¹çš„ã€Œç”Ÿæˆè¨“ç·´è³‡æ–™ã€æŒ‰éˆ•
2. å˜—è©¦ä¸åŒçš„ä»»å‹™é¡å‹
3. è§€å¯Ÿå­¸ç¿’æ¨¡å‹å¦‚ä½•æ”¹å–„å»ºè­°å“è³ª</pre>
                    `;
                }
            } catch (error) {
                console.error('âŒ é¡¯ç¤ºå­¸ç¿’æ´å¯Ÿå¤±æ•—:', error);
            }
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initializeDemo, 100);
        });
        
        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', (event) => {
            console.error('ğŸš¨ æ¼”ç¤ºé é¢éŒ¯èª¤:', event.error);
        });
    </script>
</body>
</html>