{
  "rules": {
    ".read": true,
    ".write": true,
    "rooms": {
      "$roomId": {
        ".validate": "newData.hasChildren(['id', 'created', 'phase'])",
        "id": {
          ".validate": "newData.isString() && newData.val() === $roomId"
        },
        "created": {
          ".validate": "newData.isNumber()"
        },
        "phase": {
          ".validate": "newData.isString() && newData.val().matches(/^(waiting|voting|revealing|finished)$/)"
        },
        "players": {
          "$playerId": {
            ".validate": "newData.hasChildren(['id', 'name', 'role'])",
            "id": {
              ".validate": "newData.isString() && newData.val() === $playerId"
            },
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "role": {
              ".validate": "newData.isString() && newData.val().matches(/^(dev|qa|scrum_master|po|other)$/)"
            },
            "hasVoted": {
              ".validate": "newData.isBoolean()"
            },
            "vote": {
              ".validate": "newData.val() === null || newData.isNumber() || newData.isString()"
            },
            "connected": {
              ".validate": "newData.isBoolean()"
            },
            "joined": {
              ".validate": "newData.isNumber()"
            }
          }
        },
        "votes": {
          "$playerId": {
            "playerId": {
              ".validate": "newData.isString()"
            },
            "playerName": {
              ".validate": "newData.isString()"
            },
            "playerRole": {
              ".validate": "newData.isString()"
            },
            "value": {
              ".validate": "newData.isNumber() || newData.isString()"
            },
            "timestamp": {
              ".validate": "newData.isNumber()"
            }
          }
        },
        "settings": {
          "maxPlayers": {
            ".validate": "newData.isNumber() && newData.val() > 0"
          },
          "autoReveal": {
            ".validate": "newData.isBoolean()"
          }
        }
      }
    }
  }
}