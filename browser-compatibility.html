<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨瀏覽器相容性測試 - Scrum Poker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .browser-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .browser-card {
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ddd;
            text-align: center;
        }
        
        .browser-supported { border-color: #28a745; background: #d4edda; }
        .browser-partial { border-color: #ffc107; background: #fff3cd; }
        .browser-unsupported { border-color: #dc3545; background: #f8d7da; }
        
        .feature-test {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .feature-test:last-child {
            border-bottom: none;
        }
        
        .feature-name {
            font-weight: 500;
        }
        
        .feature-status {
            text-align: center;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .supported { background: #d4edda; color: #155724; }
        .partial { background: #fff3cd; color: #856404; }
        .unsupported { background: #f8d7da; color: #721c24; }
        
        .fallback-info {
            font-size: 12px;
            color: #666;
            font-style: italic;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        
        button:hover { background: #0056b3; }
        
        .test-section {
            margin: 30px 0;
        }
        
        .version-matrix {
            overflow-x: auto;
        }
        
        .version-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .version-table th,
        .version-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: center;
        }
        
        .version-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .polyfill-section {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 16px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🌐 Scrum Poker 跨瀏覽器相容性測試</h1>
    
    <!-- 當前瀏覽器資訊 -->
    <div class="test-container">
        <h2>📱 當前瀏覽器資訊</h2>
        <div class="browser-info" id="currentBrowserInfo">
            <!-- 動態生成 -->
        </div>
        <button onclick="detectBrowser()">🔍 檢測瀏覽器</button>
        <button onclick="runCompatibilityTests()">🧪 開始相容性測試</button>
    </div>
    
    <!-- 支援的瀏覽器版本 -->
    <div class="test-container">
        <h2>✅ 支援的瀏覽器版本</h2>
        <div class="version-matrix">
            <table class="version-table">
                <thead>
                    <tr>
                        <th>瀏覽器</th>
                        <th>最低版本</th>
                        <th>建議版本</th>
                        <th>支援狀態</th>
                        <th>備註</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Chrome</strong></td>
                        <td>88+</td>
                        <td>118+</td>
                        <td class="supported">完全支援</td>
                        <td>最佳體驗</td>
                    </tr>
                    <tr>
                        <td><strong>Firefox</strong></td>
                        <td>85+</td>
                        <td>119+</td>
                        <td class="supported">完全支援</td>
                        <td>良好體驗</td>
                    </tr>
                    <tr>
                        <td><strong>Safari</strong></td>
                        <td>14+</td>
                        <td>17+</td>
                        <td class="partial">部分支援</td>
                        <td>需要 Polyfill</td>
                    </tr>
                    <tr>
                        <td><strong>Edge</strong></td>
                        <td>88+</td>
                        <td>118+</td>
                        <td class="supported">完全支援</td>
                        <td>良好體驗</td>
                    </tr>
                    <tr>
                        <td><strong>Opera</strong></td>
                        <td>74+</td>
                        <td>104+</td>
                        <td class="supported">完全支援</td>
                        <td>良好體驗</td>
                    </tr>
                    <tr>
                        <td><strong>iOS Safari</strong></td>
                        <td>14+</td>
                        <td>17+</td>
                        <td class="partial">部分支援</td>
                        <td>觸控優化</td>
                    </tr>
                    <tr>
                        <td><strong>Android Chrome</strong></td>
                        <td>88+</td>
                        <td>118+</td>
                        <td class="supported">完全支援</td>
                        <td>觸控優化</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- 功能相容性測試 -->
    <div class="test-container">
        <h2>🔧 功能相容性測試</h2>
        <div id="featureTests">
            <!-- 動態生成 -->
        </div>
    </div>
    
    <!-- CSS 功能測試 -->
    <div class="test-container">
        <h2>🎨 CSS 功能測試</h2>
        <div id="cssTests">
            <!-- 動態生成 -->
        </div>
    </div>
    
    <!-- JavaScript API 測試 -->
    <div class="test-container">
        <h2>⚡ JavaScript API 測試</h2>
        <div id="jsApiTests">
            <!-- 動態生成 -->
        </div>
    </div>
    
    <!-- Polyfill 和降級方案 -->
    <div class="test-container">
        <h2>🔧 Polyfill 和降級方案</h2>
        
        <div class="polyfill-section">
            <h3>必要的 Polyfill</h3>
            <div class="code-block">
                <!-- CSS Custom Properties Polyfill for IE -->
                &lt;script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"&gt;&lt;/script&gt;
                
                <!-- Intersection Observer Polyfill -->
                &lt;script src="https://polyfill.io/v3/polyfill.min.js?features=IntersectionObserver"&gt;&lt;/script&gt;
                
                <!-- Web Components Polyfill -->
                &lt;script src="https://unpkg.com/@webcomponents/webcomponentsjs@^2/webcomponents-loader.js"&gt;&lt;/script&gt;
            </div>
        </div>
        
        <div class="polyfill-section">
            <h3>降級策略</h3>
            <ul>
                <li><strong>CSS Grid:</strong> 自動降級為 Flexbox 佈局</li>
                <li><strong>CSS Variables:</strong> 使用 Sass 變數作為備援</li>
                <li><strong>Backdrop Filter:</strong> 降級為半透明背景</li>
                <li><strong>Intersection Observer:</strong> 使用 scroll 事件替代</li>
                <li><strong>Service Worker:</strong> 功能檢測後選擇性啟用</li>
            </ul>
        </div>
    </div>
    
    <!-- 已知問題和解決方案 -->
    <div class="test-container">
        <h2>⚠️ 已知問題和解決方案</h2>
        
        <div class="test-section">
            <h3>Safari 特定問題</h3>
            <ul>
                <li><strong>問題:</strong> CSS backdrop-filter 支援有限</li>
                <li><strong>解決方案:</strong> 使用 @supports 檢測，提供降級樣式</li>
                <li><strong>程式碼:</strong>
                    <div class="code-block">
                        @supports (backdrop-filter: blur(10px)) {
                            .glass-effect { backdrop-filter: blur(10px); }
                        }
                        
                        @supports not (backdrop-filter: blur(10px)) {
                            .glass-effect { background: rgba(255,255,255,0.8); }
                        }
                    </div>
                </li>
            </ul>
            
            <ul>
                <li><strong>問題:</strong> 觸控事件處理差異</li>
                <li><strong>解決方案:</strong> 使用統一的觸控管理器</li>
                <li><strong>程式碼:</strong>
                    <div class="code-block">
                        // TouchManager 自動檢測並標準化觸控事件
                        if ('ontouchstart' in window) {
                            // 觸控裝置
                            element.addEventListener('touchstart', handler, { passive: true });
                        } else {
                            // 滑鼠裝置
                            element.addEventListener('mousedown', handler);
                        }
                    </div>
                </li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>IE11 相容性（已不支援）</h3>
            <p class="fallback-info">
                本應用已停止支援 Internet Explorer 11。
                如需支援舊版瀏覽器，建議使用者升級到現代瀏覽器。
            </p>
        </div>
    </div>
    
    <!-- 測試結果 -->
    <div class="test-container">
        <h2>📊 測試結果</h2>
        <div id="testResults">
            <p>點擊「開始相容性測試」查看詳細結果</p>
        </div>
    </div>

    <script>
        class BrowserCompatibilityTester {
            constructor() {
                this.testResults = {};
                this.browserInfo = {};
            }
            
            // 檢測瀏覽器
            detectBrowser() {
                const ua = navigator.userAgent;
                const browserInfo = {
                    name: 'Unknown',
                    version: 'Unknown',
                    engine: 'Unknown',
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    javaEnabled: navigator.javaEnabled ? navigator.javaEnabled() : false
                };
                
                // 檢測瀏覽器類型和版本
                if (ua.includes('Chrome') && !ua.includes('Edge') && !ua.includes('OPR')) {
                    browserInfo.name = 'Chrome';
                    browserInfo.version = ua.match(/Chrome\/([0-9.]+)/)?.[1] || 'Unknown';
                    browserInfo.engine = 'Blink';
                } else if (ua.includes('Firefox')) {
                    browserInfo.name = 'Firefox';
                    browserInfo.version = ua.match(/Firefox\/([0-9.]+)/)?.[1] || 'Unknown';
                    browserInfo.engine = 'Gecko';
                } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                    browserInfo.name = 'Safari';
                    browserInfo.version = ua.match(/Version\/([0-9.]+)/)?.[1] || 'Unknown';
                    browserInfo.engine = 'WebKit';
                } else if (ua.includes('Edge')) {
                    browserInfo.name = 'Edge';
                    browserInfo.version = ua.match(/Edge\/([0-9.]+)/)?.[1] || 
                                         ua.match(/Edg\/([0-9.]+)/)?.[1] || 'Unknown';
                    browserInfo.engine = 'Blink';
                } else if (ua.includes('OPR') || ua.includes('Opera')) {
                    browserInfo.name = 'Opera';
                    browserInfo.version = ua.match(/OPR\/([0-9.]+)/)?.[1] || 
                                         ua.match(/Opera\/([0-9.]+)/)?.[1] || 'Unknown';
                    browserInfo.engine = 'Blink';
                }
                
                // 檢測移動裝置
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
                    browserInfo.mobile = true;
                    if (ua.includes('iPhone') || ua.includes('iPad')) {
                        browserInfo.platform = 'iOS';
                    } else if (ua.includes('Android')) {
                        browserInfo.platform = 'Android';
                    }
                } else {
                    browserInfo.mobile = false;
                }
                
                this.browserInfo = browserInfo;
                this.displayBrowserInfo();
                return browserInfo;
            }
            
            // 顯示瀏覽器資訊
            displayBrowserInfo() {
                const container = document.getElementById('currentBrowserInfo');
                const info = this.browserInfo;
                
                const supportClass = this.getBrowserSupportClass(info.name, info.version);
                
                container.innerHTML = `
                    <div class="browser-card ${supportClass}">
                        <h3>${info.name} ${info.version}</h3>
                        <p><strong>引擎:</strong> ${info.engine}</p>
                        <p><strong>平台:</strong> ${info.platform}</p>
                        <p><strong>語言:</strong> ${info.language}</p>
                        <p><strong>移動裝置:</strong> ${info.mobile ? '是' : '否'}</p>
                        <p><strong>線上狀態:</strong> ${info.onLine ? '已連線' : '離線'}</p>
                    </div>
                `;
            }
            
            // 取得瀏覽器支援等級
            getBrowserSupportClass(name, version) {
                const versionNum = parseFloat(version);
                
                switch (name) {
                    case 'Chrome':
                        return versionNum >= 88 ? 'browser-supported' : 'browser-unsupported';
                    case 'Firefox':
                        return versionNum >= 85 ? 'browser-supported' : 'browser-unsupported';
                    case 'Safari':
                        return versionNum >= 14 ? 'browser-partial' : 'browser-unsupported';
                    case 'Edge':
                        return versionNum >= 88 ? 'browser-supported' : 'browser-unsupported';
                    case 'Opera':
                        return versionNum >= 74 ? 'browser-supported' : 'browser-unsupported';
                    default:
                        return 'browser-unsupported';
                }
            }
            
            // 執行相容性測試
            runCompatibilityTests() {
                console.log('🧪 開始執行相容性測試...');
                
                this.detectBrowser();
                this.testCSSFeatures();
                this.testJavaScriptAPIs();
                this.testWebFeatures();
                this.displayTestResults();
            }
            
            // 測試 CSS 功能
            testCSSFeatures() {
                const cssTests = [
                    { name: 'CSS Grid', test: () => CSS.supports('display', 'grid') },
                    { name: 'CSS Flexbox', test: () => CSS.supports('display', 'flex') },
                    { name: 'CSS Custom Properties', test: () => CSS.supports('--custom-property', 'value') },
                    { name: 'CSS Transform', test: () => CSS.supports('transform', 'translateX(10px)') },
                    { name: 'CSS Transition', test: () => CSS.supports('transition', 'all 0.3s ease') },
                    { name: 'CSS Animation', test: () => CSS.supports('animation', 'test 1s linear') },
                    { name: 'CSS Filter', test: () => CSS.supports('filter', 'blur(10px)') },
                    { name: 'CSS Backdrop Filter', test: () => CSS.supports('backdrop-filter', 'blur(10px)') },
                    { name: 'CSS Clip Path', test: () => CSS.supports('clip-path', 'circle(50%)') },
                    { name: 'CSS Object Fit', test: () => CSS.supports('object-fit', 'cover') },
                    { name: 'CSS Position Sticky', test: () => CSS.supports('position', 'sticky') },
                    { name: 'CSS Aspect Ratio', test: () => CSS.supports('aspect-ratio', '16/9') }
                ];
                
                const container = document.getElementById('cssTests');
                container.innerHTML = '';
                
                cssTests.forEach(test => {
                    const supported = test.test();
                    const statusClass = supported ? 'supported' : 'unsupported';
                    const statusText = supported ? '✅ 支援' : '❌ 不支援';
                    const fallback = this.getCSSFallback(test.name);
                    
                    container.innerHTML += `
                        <div class="feature-test">
                            <div class="feature-name">${test.name}</div>
                            <div class="feature-status ${statusClass}">${statusText}</div>
                            <div class="fallback-info">${fallback}</div>
                        </div>
                    `;
                    
                    this.testResults[test.name] = supported;
                });
            }
            
            // 測試 JavaScript API
            testJavaScriptAPIs() {
                const jsTests = [
                    { name: 'Fetch API', test: () => 'fetch' in window },
                    { name: 'Promise', test: () => 'Promise' in window },
                    { name: 'LocalStorage', test: () => 'localStorage' in window },
                    { name: 'SessionStorage', test: () => 'sessionStorage' in window },
                    { name: 'WebSocket', test: () => 'WebSocket' in window },
                    { name: 'Service Worker', test: () => 'serviceWorker' in navigator },
                    { name: 'Intersection Observer', test: () => 'IntersectionObserver' in window },
                    { name: 'Performance Observer', test: () => 'PerformanceObserver' in window },
                    { name: 'Web Components', test: () => 'customElements' in window },
                    { name: 'ES6 Modules', test: () => 'noModule' in document.createElement('script') },
                    { name: 'Async/Await', test: () => {
                        try {
                            eval('(async function() {})');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }},
                    { name: 'Arrow Functions', test: () => {
                        try {
                            eval('(() => {})');
                            return true;
                        } catch (e) {
                            return false;
                        }
                    }}
                ];
                
                const container = document.getElementById('jsApiTests');
                container.innerHTML = '';
                
                jsTests.forEach(test => {
                    const supported = test.test();
                    const statusClass = supported ? 'supported' : 'unsupported';
                    const statusText = supported ? '✅ 支援' : '❌ 不支援';
                    const fallback = this.getJSFallback(test.name);
                    
                    container.innerHTML += `
                        <div class="feature-test">
                            <div class="feature-name">${test.name}</div>
                            <div class="feature-status ${statusClass}">${statusText}</div>
                            <div class="fallback-info">${fallback}</div>
                        </div>
                    `;
                    
                    this.testResults[test.name] = supported;
                });
            }
            
            // 測試 Web 功能
            testWebFeatures() {
                const webTests = [
                    { name: 'Touch Events', test: () => 'ontouchstart' in window },
                    { name: 'Pointer Events', test: () => 'onpointerdown' in window },
                    { name: 'Device Motion', test: () => 'DeviceMotionEvent' in window },
                    { name: 'Device Orientation', test: () => 'DeviceOrientationEvent' in window },
                    { name: 'Geolocation', test: () => 'geolocation' in navigator },
                    { name: 'Notifications', test: () => 'Notification' in window },
                    { name: 'Vibration', test: () => 'vibrate' in navigator },
                    { name: 'Battery API', test: () => 'getBattery' in navigator },
                    { name: 'Network Information', test: () => 'connection' in navigator },
                    { name: 'Clipboard API', test: () => 'clipboard' in navigator }
                ];
                
                const container = document.getElementById('featureTests');
                container.innerHTML = '';
                
                webTests.forEach(test => {
                    const supported = test.test();
                    const statusClass = supported ? 'supported' : 'unsupported';
                    const statusText = supported ? '✅ 支援' : '❌ 不支援';
                    const fallback = this.getWebFeatureFallback(test.name);
                    
                    container.innerHTML += `
                        <div class="feature-test">
                            <div class="feature-name">${test.name}</div>
                            <div class="feature-status ${statusClass}">${statusText}</div>
                            <div class="fallback-info">${fallback}</div>
                        </div>
                    `;
                    
                    this.testResults[test.name] = supported;
                });
            }
            
            // 取得 CSS 功能的降級方案
            getCSSFallback(feature) {
                const fallbacks = {
                    'CSS Grid': 'Flexbox 佈局',
                    'CSS Backdrop Filter': '半透明背景',
                    'CSS Custom Properties': 'Sass 變數',
                    'CSS Clip Path': '圓角邊框',
                    'CSS Aspect Ratio': '固定高度',
                    'CSS Position Sticky': '固定定位'
                };
                return fallbacks[feature] || '無降級方案';
            }
            
            // 取得 JavaScript API 的降級方案
            getJSFallback(feature) {
                const fallbacks = {
                    'Fetch API': 'XMLHttpRequest',
                    'Promise': 'Callback',
                    'Service Worker': 'Application Cache',
                    'Intersection Observer': 'Scroll 事件',
                    'Web Components': '原生 DOM 操作',
                    'Async/Await': 'Promise.then()'
                };
                return fallbacks[feature] || 'Polyfill 或移除功能';
            }
            
            // 取得 Web 功能的降級方案
            getWebFeatureFallback(feature) {
                const fallbacks = {
                    'Touch Events': '滑鼠事件',
                    'Geolocation': '手動輸入位置',
                    'Notifications': '頁面內通知',
                    'Vibration': '視覺回饋',
                    'Battery API': '隱藏電池資訊',
                    'Clipboard API': '手動複製'
                };
                return fallbacks[feature] || '功能不可用';
            }
            
            // 顯示測試結果
            displayTestResults() {
                const container = document.getElementById('testResults');
                const total = Object.keys(this.testResults).length;
                const supported = Object.values(this.testResults).filter(Boolean).length;
                const percentage = Math.round((supported / total) * 100);
                
                let resultClass = 'supported';
                if (percentage < 70) resultClass = 'unsupported';
                else if (percentage < 90) resultClass = 'partial';
                
                container.innerHTML = `
                    <div class="feature-test">
                        <div class="feature-name"><strong>整體相容性</strong></div>
                        <div class="feature-status ${resultClass}">${percentage}% (${supported}/${total})</div>
                        <div class="fallback-info">
                            ${percentage >= 90 ? '優秀的相容性' : 
                              percentage >= 70 ? '良好的相容性，需要部分降級' : 
                              '相容性較差，需要大量降級方案'}
                        </div>
                    </div>
                    
                    <h3>建議事項：</h3>
                    <ul>
                        ${percentage < 100 ? '<li>建議升級到最新版本的現代瀏覽器</li>' : ''}
                        ${!this.testResults['Service Worker'] ? '<li>無法使用離線功能</li>' : ''}
                        ${!this.testResults['CSS Backdrop Filter'] ? '<li>毛玻璃效果將使用降級樣式</li>' : ''}
                        ${!this.testResults['Intersection Observer'] ? '<li>滾動效果將使用 scroll 事件</li>' : ''}
                        ${!this.testResults['Touch Events'] && this.browserInfo.mobile ? '<li>觸控體驗可能受限</li>' : ''}
                    </ul>
                `;
                
                console.log('📊 相容性測試完成:', {
                    browser: this.browserInfo,
                    compatibility: percentage,
                    results: this.testResults
                });
            }
        }
        
        // 初始化測試器
        const compatibilityTester = new BrowserCompatibilityTester();
        
        // 全域函數
        function detectBrowser() {
            compatibilityTester.detectBrowser();
        }
        
        function runCompatibilityTests() {
            compatibilityTester.runCompatibilityTests();
        }
        
        // 頁面載入時自動檢測
        window.addEventListener('load', () => {
            detectBrowser();
            console.log('🌐 瀏覽器相容性測試頁面已載入');
        });
    </script>
</body>
</html>