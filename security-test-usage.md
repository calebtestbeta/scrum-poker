# 🧪 安全測試工具使用說明

## 📋 測試工具概覽

`security-test.html` 是一個互動式的 Firebase 安全規則測試工具，可以驗證您部署的安全規則是否正常運作。

## 🚀 使用步驟

### 第一步：設定 Firebase 配置

1. **開啟測試工具**
   - 在瀏覽器中開啟 `security-test.html`
   - 您會看到配置輸入區域

2. **填入配置資訊**
   - **API Key**: 從 Firebase 控制台取得
   - **Project ID**: 您的 Firebase 專案 ID
   - **Database URL**: Realtime Database 的 URL
   
3. **保存配置**
   - 點擊「保存配置」按鈕
   - 配置會自動保存到瀏覽器本地存儲
   - 下次開啟會自動載入

4. **驗證配置**
   - 工具會自動驗證配置格式
   - 如有問題會顯示相應提示

### 第二步：初始化 Firebase

1. **點擊「初始化 Firebase」**
   - 工具會連接到您的 Firebase 專案
   - 觀察連線狀態變化

2. **檢查連線狀態**
   - 🟢 **已連線**: Firebase 連接成功
   - 🔴 **未連線**: 連接失敗，檢查配置

### 第三步：執行安全測試

#### 🔐 測試匿名身份驗證
- 點擊「測試匿名登入」
- 驗證 Firebase Auth 匿名登入功能
- 成功後會顯示用戶 UID

#### 🚫 測試未授權存取
- 點擊「測試未授權存取」
- 驗證未登入用戶被正確拒絕
- **預期結果**: `PERMISSION_DENIED` 錯誤

#### ✅ 測試授權用戶存取
- 點擊「測試授權用戶存取」
- 驗證已登入用戶可以正常存取
- **預期結果**: 能夠讀寫自己的資料

#### 📝 測試資料驗證
- 點擊「測試資料驗證規則」
- 驗證無效資料被正確拒絕
- 測試項目：
  - 過長的玩家名稱
  - 無效的角色值
  - 錯誤的資料格式

#### 🛡️ 測試跨用戶存取防護
- 點擊「測試跨用戶存取防護」
- 驗證無法修改其他用戶的資料
- **預期結果**: `PERMISSION_DENIED` 錯誤

## 📊 結果解讀

### 成功指標 ✅
- **綠色訊息**: 測試通過，安全規則正常運作
- **匿名登入成功**: 身份驗證設定正確
- **權限拒絕**: 未授權操作被正確阻擋
- **資料驗證**: 無效資料被拒絕

### 警告指標 ⚠️
- **黃色訊息**: 可能的配置問題或警告
- **格式警告**: 配置格式可能不標準但仍可用

### 錯誤指標 ❌
- **紅色訊息**: 測試失敗或嚴重錯誤
- **連接失敗**: Firebase 配置或網路問題
- **安全漏洞**: 安全規則未正確部署

## 🔧 常見測試結果

### 理想的測試結果
```
✅ 匿名登入成功
✅ 安全正常：未授權存取被正確拒絕
✅ 授權用戶可以正常讀取資料
✅ 授權用戶可以寫入自己的玩家資料
✅ 資料驗證正常：拒絕過長的玩家名稱
✅ 資料驗證正常：拒絕無效的角色
✅ 資料驗證正常：接受有效資料
✅ 跨用戶防護正常：無法修改其他用戶資料
✅ 投票防護正常：無法修改其他用戶投票
```

### 問題診斷
如果看到以下結果，表示需要檢查：

#### 配置問題
```
❌ Firebase 配置不完整，請先設定配置
❌ 身份驗證失敗: auth/api-key-not-valid
```
**解決**: 檢查 Firebase 配置是否正確

#### 身份驗證問題
```
❌ 身份驗證失敗: auth/project-not-found
❌ 身份驗證失敗: auth/network-request-failed
```
**解決**: 
1. 確認 Project ID 正確
2. 啟用 Firebase Authentication 匿名登入
3. 檢查網路連接

#### 安全規則問題
```
❌ 安全漏洞：未授權用戶可以讀取資料
❌ 安全漏洞：可以修改其他用戶的資料
```
**解決**: 
1. 檢查 Database Rules 是否正確部署
2. 確認規則語法正確
3. 檢查 Firebase 控制台的規則頁面

## 🛠️ 故障排除

### 步驟 1: 檢查基本配置
1. 確認 API Key、Project ID、Database URL 都已填入
2. 點擊「配置指南」查看取得方法
3. 檢查配置格式是否正確

### 步驟 2: 檢查 Firebase 專案狀態
1. 前往 Firebase 控制台
2. 確認專案處於活躍狀態
3. 檢查 Realtime Database 是否已創建

### 步驟 3: 檢查身份驗證設定
1. Firebase 控制台 → Authentication
2. Sign-in method → 匿名 → 啟用

### 步驟 4: 檢查安全規則
1. Firebase 控制台 → Realtime Database → 規則
2. 確認規則已部署且為最新版本
3. 使用 Firebase 控制台的規則模擬器測試

### 步驟 5: 清除快取重試
1. 清除瀏覽器快取
2. 重新載入測試工具
3. 重新輸入配置

## 📝 測試報告

測試工具會自動生成測試摘要：
- **總測試數**: 執行的測試案例總數
- **成功數**: 通過的測試數量
- **失敗數**: 失敗的測試數量
- **成功率**: 整體測試通過百分比

### 目標成功率
- **100%**: 完美，安全規則運作正常
- **80-99%**: 良好，可能有輕微配置問題
- **<80%**: 需要檢查安全規則或配置

## 🔄 持續測試建議

1. **每次修改安全規則後都要測試**
2. **在不同瀏覽器中測試**
3. **定期執行安全測試**
4. **記錄測試結果供日後參考**
5. **與團隊分享測試結果**

---

💡 **提示**: 這個測試工具是為了驗證 Level 1 基礎安全規則而設計的，如果您實施了更高級的安全規則，可能需要相應調整測試案例。